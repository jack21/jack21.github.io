import{d as v,o as _,l as x,w as h,e as N,b as C,p as A,a0 as B,c as k,a as E}from"./index-cMTOR0Iq.js";import{i as O,b as F}from"./index-8Bi13PKl.js";import{P as $}from"./papaparse.min-j-GbZ1Dd.js";import{r as M,u as T,d as V,w as Y}from"./xlsx-M5iX-t4N.js";import{_ as j}from"./_plugin-vue_export-helper-x3n3nnut.js";const z=v({__name:"OrderMyfoneHoneyComb",setup(H){const u=/(\d{3,6})?(\D+?[市縣])(\D+?[區鄉鎮市])(.*)/,i=async()=>{const o=await window.showOpenFilePicker({id:"order-myfone-honeycomb-upload",multiple:!1,types:[{accept:{"text/csv":[".csv"]}}]});if(!o||o.length===0)return;const d=await(await o[0].getFile()).arrayBuffer();let a=O.decode(F.Buffer.from(d),"big5");a=S(a),console.log("csvText",a),$.parse(a,{header:!0,skipEmptyLines:!0,transformHeader:n=>n.trim(),complete:async n=>{if(console.log("[OrderMyfoneHoneyComb] Papa.parse complete",n),n.errors.length>0){alert("Parse Error");return}const y=[];for(let c=0;c<n.data.length;c++){const t=n.data[c];console.log(`[OrderMyfoneHoneyComb] Row: ${c+1}, ${t.訂單編號}`,t);const r=b(t.送貨地址);console.log("[OrderMyfoneHoneyComb] address",r);const P=t.供應商料號,m=I.find(s=>s.myfoneCode===P);if(!m){alert(`找不到商品，供應商料號: ${P}`);return}for(let s=0;s<m.honeycombProductList.length;s++){const p=m.honeycombProductList[s],g={OrderNo:t.訂單編號,RecipientName:t.收件人,A:null,PostalCode:r.postalCode,C:null,City:r.city,District:r.district,Address:`${r.remainingAddress} (請聯繫：${t.聯絡電話})`,Email:null,Phone:"0900000000",ProductNo:p.code,ProductName:p.name,Quantity:t.數量,State:null,BatchNo:null,SizeType:null,UnitWeight:null,ValidDate:null,SameValidDate:null,OutDate:null,ExpressType:3,StoreCode:null,StorePeriod:null,ToBack:null,Pay:null,Price:1,Note:null};y.push(g)}}const L=await(await fetch("./product/honeycomb_order_batch.xlsx")).arrayBuffer(),l=M(L,{cellStyles:!0}),w=l.Sheets[l.SheetNames[0]];T.sheet_add_json(w,y,{skipHeader:!0,origin:"A3"});const D=`峰潮訂單批次檔_${V().format("YYYYMMDD")}.xlsx`;Y(l,D,{compression:!0,cellStyles:!0,ignoreEC:!1})}})},S=o=>{const e=o.split(`
`);return e.shift(),e.join(`
`)},b=o=>{if(o){const e=o.match(u);if(e)return{postalCode:e[1],city:e[2],district:e[3],remainingAddress:e[4].trim()}}return{postalCode:void 0,city:void 0,district:void 0,remainingAddress:void 0}},I=[{myfoneCode:"P0000203615900",myfoneName:"【自由選-699】【飛利浦 PHILIPS】奈米級空氣清淨機AC0650/80",honeycombProductList:[{name:"飛利浦PHILIPS 奈米級空氣清淨機-迷你奈",code:"AC0650/80"}]},{myfoneCode:"P0000203615922",myfoneName:"【自由選-699】【飛利浦 PHILIPS】萬用鍋HD2140/50(銀白)+烤麵包機HD2582(黑)",honeycombProductList:[{name:"飛利浦PHILIPS 智慧萬用電子鍋/壓力鍋-白小萬",code:"HD2140/50"},{name:"飛利浦PHILIPS 電子式智慧型厚片烤麵包機-黑",code:"HD2582/92"}]},{myfoneCode:"P0000203615923",myfoneName:"【自由選-699】【飛利浦 PHILIPS】萬用鍋HD2140/51(紫)+烤麵包機HD2582(黑)",honeycombProductList:[{name:"飛利浦PHILIPS 智慧萬用電子鍋/壓力鍋-紫小萬",code:"HD2140/51"},{name:"飛利浦PHILIPS 電子式智慧型厚片烤麵包機-黑",code:"HD2582/92"}]},{myfoneCode:"P0000203615907",myfoneName:"【自由選】【飛利浦 PHILIPS】奈米級空氣清淨機AC1711+空氣清淨機AC0650",honeycombProductList:[{name:"飛利浦PHILIPS 奈米級抗敏空氣清淨機",code:"AC1711/80"},{name:"飛利浦PHILIPS 奈米級空氣清淨機-迷你奈",code:"AC0650/80"}]}];return(o,e)=>{const f=A,d=B;return _(),x(d,{title:"myfone 訂單 → 峰潮出貨",class:"order-myfone-honeycomb"},{default:h(()=>[C(f,{variant:"primary",size:"sm",onClick:i},{default:h(()=>[N("上傳 myfone 訂單")]),_:1})]),_:1})}}}),R={},X={class:"order"},G={class:"zones"};function Q(H,u){const i=z;return _(),k("div",X,[E("div",G,[C(i)])])}const ee=j(R,[["render",Q]]);export{ee as default};
